<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æ—¥è¨˜ä¸€è¦§ - æ—¥è¨˜ç®¡ç†ã‚¢ãƒ—ãƒª</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
</head>
<body>
    <div class="container">
        <h1>ğŸ“– æ—¥è¨˜ä¸€è¦§</h1>
        
        <!-- ãƒŠãƒ“ã‚²ãƒ¼ã‚·ãƒ§ãƒ³ -->
        <div class="nav">
            <a href="{{ url_for('post') }}">âœï¸ æ–°ã—ã„æ—¥è¨˜ã‚’æ›¸ã</a>
        </div>
        
        <!-- æ¤œç´¢ãƒ•ã‚©ãƒ¼ãƒ  -->
        <div class="search-form">
            <form method="GET" action="{{ url_for('index') }}">
                <div class="search-input-group">
                    <input type="text" name="search" value="{{ search_query }}" 
                           placeholder="æ—¥è¨˜ã®å†…å®¹ã‚„æ—¥ä»˜ã§æ¤œç´¢...">
                    <button type="submit" class="btn btn-primary">ğŸ” æ¤œç´¢</button>
                    {% if search_query %}
                        <a href="{{ url_for('index') }}" class="btn">ã‚¯ãƒªã‚¢</a>
                    {% endif %}
                </div>
            </form>
        </div>
        
        <!-- ä¸¦ã³æ›¿ãˆã‚ªãƒ—ã‚·ãƒ§ãƒ³ -->
        <div class="sort-options">
            <form method="GET" action="{{ url_for('index') }}" class="sort-form">
                <input type="hidden" name="search" value="{{ search_query }}">
                <select name="sort" onchange="this.form.submit()">
                    <option value="date" {% if sort_by == 'date' %}selected{% endif %}>æ—¥ä»˜é †</option>
                    <option value="id" {% if sort_by == 'id' %}selected{% endif %}>æŠ•ç¨¿é †</option>
                </select>
                <select name="order" onchange="this.form.submit()">
                    <option value="desc" {% if order == 'desc' %}selected{% endif %}>æ–°ã—ã„é †</option>
                    <option value="asc" {% if order == 'asc' %}selected{% endif %}>å¤ã„é †</option>
                </select>
            </form>
        </div>
        
        <!-- ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸è¡¨ç¤º -->
        {% with messages = get_flashed_messages(with_categories=true) %}
            {% if messages %}
                {% for category, message in messages %}
                    <div class="message {{ category }}">{{ message }}</div>
                {% endfor %}
            {% endif %}
        {% endwith %}
        
        <!-- æ—¥è¨˜ä¸€è¦§ -->
        {% if diaries %}
            <!-- è¡¨ç¤ºä»¶æ•°æƒ…å ± -->
            {% if pagination %}
                <div class="result-info">
                    <p>{{ pagination.start_index }}ã€œ{{ pagination.end_index }}ä»¶ç›® 
                       (å…¨{{ pagination.total }}ä»¶)</p>
                </div>
            {% endif %}
            
            <div class="diary-list">
                {% for diary in diaries %}
                    <div class="diary-card">
                        <div class="diary-header">
                            <span class="diary-date">ğŸ“… {{ diary.date | format_date }}</span>
                            <span class="diary-id">#{{ diary.id }}</span>
                        </div>
                        <div class="diary-content">
                            {{ diary.content | truncate_content(150) | replace('\n', '<br>') | safe }}
                        </div>
                        <div class="diary-footer">
                            <small class="created-at">
                                ä½œæˆ: {{ diary.created_at }}
                            </small>
                        </div>
                    </div>
                {% endfor %}
            </div>
            
            <!-- ãƒšãƒ¼ã‚¸ãƒãƒ¼ã‚·ãƒ§ãƒ³ -->
            {% if pagination and pagination.total_pages > 1 %}
                <div class="pagination">
                    {% if pagination.has_prev %}
                        <a href="{{ url_for('index', page=pagination.prev_num, search=search_query, sort=sort_by, order=order) }}" 
                           class="btn">Â« å‰ã¸</a>
                    {% endif %}
                    
                    <span class="page-info">
                        {{ pagination.page }} / {{ pagination.total_pages }}
                    </span>
                    
                    {% if pagination.has_next %}
                        <a href="{{ url_for('index', page=pagination.next_num, search=search_query, sort=sort_by, order=order) }}" 
                           class="btn">æ¬¡ã¸ Â»</a>
                    {% endif %}
                </div>
            {% endif %}
        {% else %}
            <!-- æ—¥è¨˜ãŒãªã„å ´åˆ -->
            <div class="empty-state">
                {% if search_query %}
                    <h2>ğŸ” æ¤œç´¢çµæœãŒã‚ã‚Šã¾ã›ã‚“</h2>
                    <p>ã€Œ{{ search_query }}ã€ã«ä¸€è‡´ã™ã‚‹æ—¥è¨˜ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“ã§ã—ãŸã€‚</p>
                    <a href="{{ url_for('index') }}" class="btn">å…¨ã¦ã®æ—¥è¨˜ã‚’è¡¨ç¤º</a>
                {% else %}
                    <h2>ğŸ“ ã¾ã æ—¥è¨˜ãŒã‚ã‚Šã¾ã›ã‚“</h2>
                    <p>æœ€åˆã®æ—¥è¨˜ã‚’æ›¸ã„ã¦ã¿ã¾ã—ã‚‡ã†ï¼</p>
                    <a href="{{ url_for('post') }}" class="btn btn-primary">âœï¸ æ—¥è¨˜ã‚’æ›¸ã</a>
                {% endif %}
            </div>
        {% endif %}
    </div>
</body>
</html>